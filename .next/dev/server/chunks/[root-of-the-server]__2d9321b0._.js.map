{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/arturogrottoli/Downloads/python-movies-main%202/app/api/movies/search/route.ts"],"sourcesContent":["const TMDB_API_KEY = process.env.TMDB_API_KEY\nconst TMDB_BASE_URL = \"https://api.themoviedb.org/3\"\nconst TMDB_IMAGE_BASE_URL = \"https://image.tmdb.org/t/p/w500\"\n\nexport async function GET(request: Request) {\n  const { searchParams } = new URL(request.url)\n  const query = searchParams.get(\"q\")\n\n  if (!query) {\n    return Response.json({ results: [] })\n  }\n\n  if (!TMDB_API_KEY) {\n    return Response.json(\n      { \n        results: [], \n        error: \"TMDB_API_KEY no está configurada. Por favor, crea un archivo .env.local con tu API key de TMDB.\" \n      }, \n      { status: 400 }\n    )\n  }\n\n  try {\n      const [movieResponse, personResponse] = await Promise.all([\n        fetch(\n          `${TMDB_BASE_URL}/search/movie?query=${encodeURIComponent(query)}&api_key=${TMDB_API_KEY}&language=es-ES`\n        ),\n        fetch(\n          `${TMDB_BASE_URL}/search/person?query=${encodeURIComponent(query)}&api_key=${TMDB_API_KEY}&language=es-ES`\n        ),\n      ])\n\n      if (!movieResponse.ok && !personResponse.ok) {\n        console.error(\"TMDB API error:\", movieResponse.status, personResponse.status)\n        throw new Error(\"TMDB API request failed\")\n      }\n\n      const movieResults = movieResponse.ok ? await movieResponse.json() : { results: [] }\n      const personResults = personResponse.ok ? await personResponse.json() : { results: [] }\n\n      const directorIds = new Set<number>()\n      personResults.results.forEach((person: any) => {\n        if (person.known_for_department === \"Directing\") {\n          directorIds.add(person.id)\n        }\n      })\n\n      const allMovieIds = new Set<number>()\n      const movies = movieResults.results.slice(0, 15)\n\n      if (directorIds.size > 0) {\n        for (const directorId of Array.from(directorIds).slice(0, 3)) {\n          try {\n            const directorMoviesResponse = await fetch(\n              `${TMDB_BASE_URL}/person/${directorId}/movie_credits?api_key=${TMDB_API_KEY}&language=es-ES`\n            )\n            if (directorMoviesResponse.ok) {\n              const directorMovies = await directorMoviesResponse.json()\n              const directedMovies = directorMovies.crew\n                ?.filter((credit: any) => credit.job === \"Director\")\n                .slice(0, 10) || []\n              \n              directedMovies.forEach((credit: any) => {\n                if (credit.id) {\n                  allMovieIds.add(credit.id)\n                }\n              })\n            }\n          } catch (e) {\n            console.error(\"Error fetching director movies:\", e)\n          }\n        }\n      }\n\n      for (const movie of movies) {\n        allMovieIds.add(movie.id)\n      }\n\n      const movieDetailsPromises = Array.from(allMovieIds).slice(0, 20).map(async (movieId) => {\n        try {\n          const detailResponse = await fetch(\n            `${TMDB_BASE_URL}/movie/${movieId}?api_key=${TMDB_API_KEY}&language=es-ES&append_to_response=credits`\n          )\n          if (detailResponse.ok) {\n            return await detailResponse.json()\n          }\n        } catch (e) {\n          console.error(`Error fetching movie ${movieId}:`, e)\n        }\n        return null\n      })\n\n      const movieDetails = (await Promise.all(movieDetailsPromises)).filter((m) => m !== null)\n\n      const results = movieDetails.map((movie: any) => {\n        const director = movie.credits?.crew?.find((person: any) => person.job === \"Director\")\n        return {\n          id: movie.id,\n          title: movie.title,\n          year: movie.release_date ? new Date(movie.release_date).getFullYear() : 0,\n          rating: movie.vote_average || 0,\n          poster: movie.poster_path ? `${TMDB_IMAGE_BASE_URL}${movie.poster_path}` : \"/placeholder.svg\",\n          director: director?.name || undefined,\n        }\n      })\n\n      return Response.json({ results: results.slice(0, 20) })\n  } catch (error) {\n    console.error(\"TMDB API Error:\", error)\n    return Response.json({ \n      results: [], \n      error: error instanceof Error ? error.message : \"Error al buscar películas en TMDB\" \n    }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}